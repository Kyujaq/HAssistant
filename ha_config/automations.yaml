# Active automations for Letta Memory Integration

# Daily memory maintenance - runs cleanup at 3 AM
- id: letta_memory_maintenance
  alias: Letta - Daily Memory Maintenance
  description: Clean up old memories based on tier retention policies
  trigger:
    - platform: time
      at: "03:00:00"
  action:
    - service: rest_command.letta_memory_maintenance
      data: {}

# Log important state changes to memory
- id: letta_log_important_events
  alias: Letta - Log Important State Changes
  description: Save significant home events to long-term memory
  trigger:
    - platform: state
      entity_id:
        - person.home_owner  # Adjust to your person entity
      to: 
        - home
        - away
  action:
    - service: rest_command.letta_add_memory
      data:
        title: "Presence Change: {{ trigger.to_state.attributes.friendly_name }}"
        content: "{{ trigger.to_state.attributes.friendly_name }} changed from {{ trigger.from_state.state }} to {{ trigger.to_state.state }} at {{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        tags: '["presence", "automation", "home_state"]'
        source: '["ha://{{ trigger.entity_id }}"]'
        confidence: 0.95
        tier: "medium"
        type: "event"

# Example automation demonstrating Letta Bridge memory integration
# This automation shows how to push events to the memory system
#
# To use this automation:
# 1. Uncomment the automation below
# 2. Replace sensor.example_sensor with your actual sensor entity
# 3. Customize the title, content, and tags to match your use case

# - id: example_memory_automation
#   alias: Example - Save Sensor Event to Memory
#   trigger:
#     - platform: state
#       entity_id: sensor.example_sensor
#       to: "some_state"
#   action:
#     - service: rest_command.letta_add_memory
#       data:
#         title: "Sensor state changed"
#         content: "{{ trigger.entity_id }} changed to {{ trigger.to_state.state }}"
#         tags: '["automation", "sensor", "example"]'
#         source: '["ha://{{ trigger.entity_id }}"]'
#         confidence: 0.85
#         tier: "short"
#         pin: false
#         generate_embedding: true

# Example automation: Morning briefing notification
# - id: morning_brief_notification
#   alias: Morning Brief - Daily Summary
#   trigger:
#     - platform: time
#       at: "08:00:00"
#   action:
#     - service: notify.notify
#       data:
#         title: "Daily Memory Brief"
#         message: "{{ state_attr('sensor.letta_daily_brief', 'items') | length }} memories from the past 24 hours"

[]
